<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-shadow/paper-shadow.html">
<link rel="import" href="../../../bower_components/marked-element/marked-element.html">
<link rel="import" href="../../../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../../../bower_components/core-icon/core-icon.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../crypto-address/crypto-address.html">
<link rel="import" href="../../section-group/section-group.html">
<link rel="import" href="../../nice-number/nice-number.html">
<link rel="import" href="../../coinport-api/api-currency-transactions.html">
<link rel="import" href="../../coinport-api/api-currency-balance-snapshots.html">

<polymer-element name="data-subpage" attributes="currency" flex>
  <template>
    <link rel="stylesheet" href="data-subpage.css">

    <api-currency-transactions id="ajax1" currencyId="{{currency.id}}" transactions="{{transactions}}" hasMore="{{hasMoreTxs}}" auto></api-currency-transactions>
    <api-currency-balance-snapshots id="ajax2" currencyId="{{currency.id}}" snapshots="{{snapshots}}" hasMore="{{hasMoreSnapshots}}" auto></api-currency-balance-snapshots>

    <section-group hasFooter="true" >
      <paper-shadow z="0">
        <div label>
          <h2>{{currency.name}} {{M.transactions}}</h2>
          <p>{{currency.name | formatTransactionsComment}} </p>
        </div>
        <div class="card" vertical center layout>
          <table class="simple">
            <thead>
              <tr>
                <th>{{currency.id}} {{M.address}}</th>
                <th>{{currency.id}} {{M.transaction}}</th>
                <th>{{M.type}}</th>
                <th>{{M.userId}}</th>
                <th text-right>{{M.amount}}</th>
                <th text-right>{{M.timestamp}}</th>
              </tr>
            </thead>
            <tbody>
              <template repeat="{{tx in transactions}}">
                <tr>
                  <td>
                    <crypto-address class="{{group.label}}" currency="{{currency}}" addr="{{tx.address}}"></crypto-address>
                  </td>
                  <td><a href="{{tx.txid | formatTxUrl}}">{{tx.txid | formatTxLabel}}</a>
                  </td>
                  <td>{{M.operationsLabel[tx.operation]}}</td>
                  <td>{{tx.uid}}</td>
                  <td text-right>
                    <nice-number v="{{tx.amount}}" p="4"></nice-number>
                  </td>
                  <td text-right>{{tx.created | formatTime}}</td>
                </tr>
              </template>
            </tbody>
          </table>
          <paper-button class="load-button" disabled?="{{!hasMoreTxs}}" on-tap="{{loadMoreTxs}}">Load more</paper-button>
        </div>
      </paper-shadow>

      <paper-shadow z="0">
        <div label>
          <h2>{{currency.name}} |{{M.distributionSnapshots}}</h2>
          <p>{{currency.name | formatDistributionSnapshotsComment}}</p>
        </div>
        <div class="card" vertical center layout>
          <table class="simple">
            <thead>
              <tr>
                <th>{{M.file}}</th>
                <th>{{M.size}}</th>
                <th text-right>{{M.timestamp}}</th>
              </tr>
            </thead>
            <tbody>
              <template repeat="{{snapshot in snapshots}}">
                <tr>
                  <td>
                    <a href="{{fileBase + snapshot[0]}}">
                      {{snapshot[0]}}<core-icon class="small" icon="file-download"></core-icon></a>
                  </td>
                  <td>{{snapshot[1]}} Bytes</td>
                  <td text-right>{{snapshot[2] | formatTime}}</td>
                </tr>
              </template>
            </tbody>
          </table>
          <paper-button class="load-button" disabled?="{{!hasMoreSnapshots}}" on-tap="{{loadMoreSnapshots}}">Load more</paper-button>
        </div>
      </paper-shadow>
    </section-group>
  </template>

  <script src="data-subpage.js"></script>
</polymer-element>
