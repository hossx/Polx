<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-shadow/paper-shadow.html">
<link rel="import" href="../../../bower_components/marked-element/marked-element.html">
<link rel="import" href="../../../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../../../bower_components/core-icon/core-icon.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../crypto-address/crypto-address.html">
<link rel="import" href="../../section-group/section-group.html">

<polymer-element name="data-subpage" attributes="currency" flex>
  <template>
    <link rel="stylesheet" href="data-subpage.css">

    <section-group has-footer>
      <paper-shadow>
        <core-ajax id="txsAjax" url="{{txsUrl}}" on-core-complete="{{handleTxsComplete}}" auto></core-ajax>
        <div label>
          <h2>{{currency.name}} {{M.transactions}}</h2>
          <p>{{currency.name | formatTransactionsComment}} </p>
        </div>
        <div class="card" vertical center layout>
          <table>
            <thead>
              <tr>
                <th>{{M.timestamp}}</th>
                <th>{{M.userId}}</th>
                <th>{{M.type}}</th>
                <th>{{M.amount}}</th>
                <th>{{currency.id}} {{M.address}}</th>
                <th>{{currency.id}} {{M.transaction}}</th>
              </tr>
            </thead>
            <tbody>
              <template repeat="{{tx in transactions}}">
                <tr>
                  <td>{{tx[1]}}</td>
                  <td>
                    <a href="{{tx[2]}} | formatUserUrl}}">{{tx[2]}}</a>
                  </td>
                  <td>{{tx[3]}}</td>
                  <td>{{tx[4]}}</td>
                  <td >
                    <a href="{{tx[5]}} | formatAddrUrl}}">
                      <crypto-address class="{{group.label}}" currency="{{currency}}" addr="{{tx[5]}}"></crypto-address>
                    </a>
                  </td>
                  <td><a href="{{tx[6] | formatTxUrl}}">{{tx[6]}}</a>
                  </td>
                </tr>
              </template>
            </tbody>
          </table>
          <paper-button class="load-button" disabled?="{{!hasMoreTxs}}" on-tap="{{loadMoreTxs}}">Load more</paper-button>
        </div>
      </paper-shadow>

      <paper-shadow>
        <core-ajax id="snapshotAjax" url="{{balanceSnapshotFilesUrl}}" on-core-complete="{{handleSnapshotsComplete}}" auto></core-ajax>
        <div label>
          <h2>{{currency.name}} |{{M.distributionSnapshots}}</h2>
          <p>{{currency.name | formatDistributionSnapshotsComment}}</p>
        </div>
        <div class="card" vertical center layout>
          <table>
            <thead>
              <tr>
                <th>{{M.timestamp}}</th>
                <th>{{M.file}}</th>
                <th>{{M.size}}</th>
              </tr>
            </thead>
            <tbody>
              <template repeat="{{snapshot in snapshots}}">
                <tr>
                  <td>{{snapshot[2] | formatTime}}</td>
                  <td>
                    <a href="{{fileBase + snapshot[0]}}">
                      <core-icon class="small" icon="file-download"></core-icon>{{snapshot[0]}}</a>
                  </td>
                  <td>{{snapshot[1]}}</td>
                </tr>
              </template>
            </tbody>
          </table>
          <paper-button class="load-button" disabled?="{{!hasMoreSnapshots}}" on-tap="{{loadMoreSnapshots}}">Load more</paper-button>
        </div>
      </paper-shadow>
    </section-group>
  </template>

  <script src="data-subpage.js"></script>
</polymer-element>
