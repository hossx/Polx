<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../../../bower_components/core-dropdown-menu/core-dropdown-menu.html">
<link rel="import" href="../../../bower_components/core-dropdown/core-dropdown.html">
<link rel="import" href="../../../bower_components/core-menu/core-menu.html">
<link rel="import" href="../../../bower_components/core-item/core-item.html">
<link rel="import" href="../../../bower_components/core-icon/core-icon.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../section-group/section-group.html">
<link rel="import" href="../../crypto-address/crypto-address.html">
<link rel="import" href="../../crypto-tx/crypto-tx.html">
<link rel="import" href="../../coinport-api/api-my-withdrawals.html">
<link rel="import" href="../../load-data-widget/load-data-widget.html">
<link rel="import" href="withdraw-widget.html">

<polymer-element name="withdraw-subpage" attributes="profile,currencyId,active,balance">
  <template>
    <link rel="stylesheet" href="withdraw-subpage.css">

    <section-group hasFooter="true" fit>
      <paper-shadow z="0">
        <div label>
          <h2>{{M.withdraw}}</h2>
        </div>
        <div vertical center layout class="container1">
          <table>
            <tbody>
              <tr>
                <th text-right>{{M.currencyToWithdraw}}</th>
                <td>
                  <core-dropdown-menu label="{{currency.fullName}}" class="dropdownMenu">
                    <core-dropdown class="dropdown">
                      <core-menu valueattr="id" selected="{{currencyId}}">
                        <template repeat="{{c in currencyKeys}}">
                          <core-item id="{{c}}">{{config.currencies[c].fullName}}</core-item>
                        </template>
                      </core-menu>
                    </core-dropdown>
                  </core-dropdown-menu>
                </td>
              </tr>
              <tr>
                <th text-right>{{M.balance}}</th>
                <td id="balance">
                  <nice-number p="4" v="{{selectedBalance}}" currency="{{currency}}" unit="{{currency.unit}}"></nice-number>
                </td>
              </tr>
            </tbody>
          </table>

          <div class="instruction" vertical center layout>
            <withdraw-widget
            balance="{{selectedBalance}}"
            limit="{{getWithdrawalLimit(currency.id)}}"
            currency="{{currency.id}}"
            needEmailAuth="{{profile.emailAuthEnabled}}"
            needMobileAuth="{{profile.mobileAuthEnabled}}"
            needGoogleAuth="{{profile.googleAuthEnabled}}"
            needWithdrawalAddress="{{currency.id != 'CNY'}}"
            needBankAddress="{{currency.id == 'CNY'}}"
            address="{{withdrawalAddress}}"
            cnyAddress="{{cnyAddress}}"
            quantity="{{quantity}}"
            emailVCode="{{emailVCode}}"
            smsVCode="{{smsVCode}}"
            googleVCode="{{googleVCode}}"
            emailUuid="{{emailUuid}}"
            phoneUuid="{{phoneUuid}}"
            pubkey="{{pubkey}}"
            memo="{{memo}}"
            needPubkey="{{currency.id == 'NXT'}}"
            needMemo="{{currency.id == 'BTSX'}}"
            realname="{{profile.realName}}"
            on-withdraw-succeed="{{onWithdrawSucceed}}"
            ></withdraw-widget>
          </div>

          <template if="{{currency.id == 'CNY'}}">
            <div class="instruction" vertical start layout>
              <template if="{{lang == 'zh'}}">
                <div class="alsoNote" horizontal center layout>
                  <core-icon icon="info-outline"></core-icon>
                  <ul>
                    <li>每次提现的最小金额为 {{fee['CNY']['l']}}。</li>
                    <li>提现手续费： {{fee['CNY']['f']}}。</li>
                    <li>{{currency.name}}提现需要人工处理，我们的服务时间是北京时间早10点到晚10点。</li>
                    <li>在上述时间内，您的提现一般会在一个小时内被处理。</li>
                  </ul>
                </div>
              </template>

              <template if="{{lang == 'en'}}">
                <div class="alsoNote" horizontal center layout>
                  <core-icon icon="info-outline"></core-icon>
                  <ul>
                    <li>The minimum amount for withdraw is 100 {{currency.unit}}.</li>
                    <li>CNY withdrawal fee: {{fee['CNY']['f']}}.</li>
                    <li>Manual processing of {{currency.name}} is only available between 10:00AM and 10:00PM Beijing Time.</li>
                    <li>During the above hours, we nomally process your requests within 1 hour.</li>
                  </ul>
                </div>
              </template>
            </div>
          </template>

          <template if="{{currency.id != 'CNY'}}">
              <div class="instruction" vertical center layout>
                  <div class="warning">
                      {{currency.id | genWithdrawalDesc}}
                      <template if="{{currency.id == 'BTSX'}}">
                          <div class="red">
                              <template if="{{lang=='zh'}}">
                                  BTSX目前只支持使用已注册的帐号提币（比如coinport-deposit）。
                              </template>
                              <template if="{{lang=='en'}}">
                                  Due to BTSX's API, now only support registered ID(Eg. coinport-deposit) to withdraw.
                              </template>
                          </div>
                      </template>
                  </div>
              </div>
          </template>
        </div>
      </paper-shadow>

      <paper-shadow z="0">
        <div label>
          <h2>{{M.history}}</h2>
        </div>
        <div vertical center layout class="container2">
          <table class="simple">
            <thead>
              <tr>
                <th>{{M.id}}</th>
                <template if="{{currency.isCrypto}}">
                  <th>{{currency.id}} {{M.address}}</th>
                  <th>{{currency.id}} {{M.transaction}}</th>
                </template>
                <th text-right>{{M.quantity}}</th>
                <th text-right>{{M.timestamp}}</th>
                <th text-right>{{M.status}}</th>
              </tr>
            </thead>
            <tbody>
              <template repeat="{{d in withdrawals}}">
                <tr>
                  <td>{{d.id}}</td>
                  <template if="{{currency.isCrypto}}">
                    <td>
                      <crypto-address currency="{{currency}}" addr="{{d.address}}"></crypto-address>
                    </td>
                    <td>
                      <template if="{{d.txid}}">
                        <crypto-tx currency="{{currency}}" tx="{{d.txid}}"></crypto-tx>
                      </template>
                      <template if="{{!d.txid}}">
                        {{M.na}}
                      </template>
                    </td>
                  </template>
                  <td text-right class="withdraw">
                    <nice-number v="{{d.amount}}" p="4"></nice-number>
                  </td>
                  <td text-right>{{d.created | formatTime}}</td>
                  <td text-right>{{M.statusLabels[d.status]}}</td>
                </tr>
              </template>
            </tbody>
          </table>

          <api-my-withdrawals id="withdrawalsAjax" currencyId="{{currencyId}}" withdrawals="{{withdrawals}}" loading="{{loading}}"
          hasMore="{{hasMore}}" auto?="{{active}}"></api-my-withdrawals>
          <load-data-widget hasMore="{{hasMore}}" loading="{{loading}}" data="{{withdrawals}}" loadMore="{{loadMore}}"></load-data-widget>
        </div>
      </paper-shadow>
    </section-group>

  </template>

  <script src="withdraw-subpage.js"></script>
</polymer-element>
