<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/chart-elements/chart-js-import.html">

<polymer-element name="better-chart-pie" attributes="width height values colors labels">
  <template>
    <style>
      :host {
        display: inline-block;
      }
    </style>
    <div id="parent"></div>
  </template>
  <script>
    Polymer({
      height: 0,
      width: 0,
      colors: null,
      values: null,
      labels: null,
      observe: {
        height: 'updateChart',
        width: 'updateChart',
        colors: 'updateChart',
        values: 'updateChart',
        labels: 'updateChart'
      },
      updateChart: function() {
        if (this.height > 0 && this.width > 0 && this.labels !== null && this.colors !== null && this.values !== null) {
          this.$.parent.innerHTML = '<canvas id="canvas" width="' + this.width + '" height="' + this.height + '"></canvas>';
          if (this.chart) {
            this.chart.destroy();
          }
          this.data = [];
          this.values.forEach(function(val, i) {
            this.data.push({
              color: this.colors[i],
              value: val,
              label: this.labels[i]
            });
          }, this);
          this.ctx = this.$.parent.firstChild.getContext('2d');
          this.chart = new Chart(this.ctx).Pie(this.data, {segmentStrokeColor: '#fff',segmentStrokeWidth: 1});
        }
      }
    });
  </script>
</polymer-element>
