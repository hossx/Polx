<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../../bower_components/core-drawer-panel/core-drawer-panel.html">
<link rel="import" href="../../bower_components/core-header-panel/core-header-panel.html">
<link rel="import" href="../../bower_components/core-animated-pages/core-animated-pages.html">
<link rel="import" href="../../bower_components/core-animated-pages/transitions/slide-from-right.html">
<link rel="import" href="../../bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="../../bower_components/core-tooltip/core-tooltip.html">
<link rel="import" href="../../bower_components/core-icon/core-icon.html">
<link rel="import" href="../../bower_components/core-icon-button/core-icon-button.html">
<link rel="import" href="../../bower_components/core-media-query/core-media-query.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/core-icons/communication-icons.html">
<link rel="import" href="../cp-icons/crypto-icons.html">
<link rel="import" href="../cp-footer/cp-footer.html">
<link rel="import" href="../nice-number/nice-number.html">
<link rel="import" href="../charts/depth-chart/depth-chart.html">
<link rel="import" href="../market-page/elements/market-sidebar.html">
<link rel="import" href="../coinport-api/api-market-ticker.html">
<link rel="import" href="../coinport-api/api-market-depth.html">
<link rel="import" href="../coinport-api/api-market-trade-history.html">

<polymer-element name="market-pro-page" attributes="marketId">
  <template>
    <link rel="stylesheet" href="market-pro-page.css">
    <core-media-query query="min-width: 768px" queryMatches="{{smallup}}"></core-media-query>

    <api-market-ticker marketId="{{marketId}}" ticker="{{ticker}}" auto></api-market-ticker>
    <api-market-depth marketId="{{marketId}}" bids="{{bids}}" bidsReverse="{{bidsReverse}}" asks="{{asks}}" spread="{{spread}}"
    auto></api-market-depth>
    <api-market-trade-history marketId="{{marketId}}" trades="{{trades}}" auto></api-market-trade-history>

    <core-drawer-panel forceNarrow>

      <core-header-panel mode="seamed" id="drawer" drawer>
        <market-sidebar marketId="{{marketId}}" altview="{{true}}"></market-sidebar>
      </core-header-panel>

      <core-header-panel id="main-panel" mode="waterfall" fix main>
        <core-toolbar class="core-header" id="toolbar">
          <a href="/#/markets" id="backlink">
            <paper-icon-button icon="arrow-back"></paper-icon-button>
          </a>
          <paper-icon-button icon="menu" core-drawer-toggle></paper-icon-button>
          <div id="label">{{market.name}}</div>

          <div class="divider"></div>
          <div class="stat" vertical layout>
            <nice-number v="{{ticker.price}}" unit="{{market.baseCurrency.unit}}"></nice-number>
            <div>{{M.lastPrice}}</div>
          </div>

          <div class="stat" vertical layout>
            <nice-number v="{{ticker.volume}}" p="2" unit="{{market.currency.unit}}"></nice-number>
            <div>{{M.volume}}</div>
          </div>

          <div class="stat" vertical layout>
            <div class="{{ticker.changeType}}">{{ticker.changeTxt}}</nice-number>
            </div>
            <div>{{M.change}}</div>
          </div>
          <div class="divider"></div>
          <div flex></div>

          <a href="/#/market/{{marketId}}">
            <core-tooltip label="{{M.relaxMode}}" position="left">
              <paper-icon-button icon="explore"></paper-icon-button>
            </core-tooltip>
          </a>
        </core-toolbar>

        <div id="main" wrap flex vertical?={{!smallup}} horizontal?={{smallup}} layout main>
          <div class="column" auto-vertical flex vertical layout>

            <div class="block" id="trade" vertical layout>
              <div class="content" vertical layout>
                <paper-tabs selected="{{selected}}">
                  <paper-tab>{{M.buyAction}}</paper-tab>
                  <paper-tab>{{M.sellAction}}</paper-tab>
                </paper-tabs>
                <core-animated-pages class="pages" selected="{{selected}}">
                  <section>
                    <div class="form" vertical layout>
                      <div center horizontal layout>
                        <div flex>Quantity</div>
                        <input flex two is="core-input" type="number" min="0" step="0.0001" preventInvalidInput placeholder="0.0000" value="{{buyQuantity}}"
                        committedValue="{{committedBuyQuantity}}">
                      </div>
                      <div horizontal center layout>
                        <div flex>Price</div>
                        <input flex two is="core-input" type="number" min="0" step="0.00000001" preventInvalidInput placeholder="0.0000" value="{{buyPrice}}"
                        committedValue="{{committedBuyPrice}}">
                      </div>
                      <div horizontal center layout>
                        <div flex>Total {{market.baseCurrency.unit}}</div>
                        <div flex two>
                          <nice-number v="{{buyQuantity * buyPrice}}"></nice-number>
                        </div>
                      </div>
                      <paper-button disabled?="{{!buyEnabled}}">{{M.buyAction}} {{market.currency.id}}</paper-button>
                    </div>
                  </section>
                  <section>
                    <div class="form" vertical layout>
                      <div center horizontal layout>
                        <div flex>Quantity</div>
                        <input flex two is="core-input" type="number" min="0" step="0.0001" preventInvalidInput placeholder="0.0000" value="{{sellQuantity}}"
                        committedValue="{{committedSellQuantity}}">
                      </div>
                      <div horizontal center layout>
                        <div flex>Price</div>
                        <input flex two is="core-input" type="number" min="0" step="0.00000001" preventInvalidInput placeholder="0.0000" value="{{sellPrice}}"
                        committedValue="{{committedSellPrice}}">
                      </div>
                      <div horizontal center layout>
                        <div flex>Total {{market.baseCurrency.unit}}</div>
                        <div flex two>
                          <nice-number v="{{sellQuantity * sellPrice}}"></nice-number>
                        </div>
                      </div>
                      <paper-button disabled?="{{!sellEnabled}}">{{M.sellAction}} {{market.currency.id}}</paper-button>
                    </div>
                  </section>
                </core-animated-pages>
              </div>
            </div>
            <div class="block" id="availableBalance" vertical layout>
              <div class="head" center horizontal layout>
                <div class="title">{{M.availableBalance}}</div>
              </div>
              <div class="content" vertical layout>
                <div class="actions" horizontal layout>
                  <paper-button flex>
                    <core-icon class="small" icon="communication:call-received"></core-icon>{{M.deposit}}</paper-button>
                  <paper-button flex>
                    <core-icon class="small" icon="communication:call-made"></core-icon>{{M.withdraw}}</paper-button>
                </div>
                <div class="balance" horizontal layout>
                  <div flex><a href="/#/currency/{{market.baseCurrency.id}}">{{market.baseCurrency.id}}</a>
                  </div>
                  <div flex>
                    <nice-number v="{{123}}"></nice-number>
                  </div>
                </div>
                <div class="balance" horizontal layout>
                  <div flex><a href="/#/currency/{{market.currency.id}}">{{market.currency.id}}</a>
                  </div>
                  <div flex>
                    <nice-number v="{{123}}"></nice-number>
                  </div>
                </div>
              </div>
            </div>
            <div class="block" id="transfers" vertical layout>
              <div class="head" center horizontal layout>
                <div class="title">{{M.transfers}}</div>
              </div>
              <div class="content" vertical layout>
                this is the content
              </div>
            </div>
          </div>

          <div class="column" auto-vertical flex vertical layout>
            <div class="block" id="orderbook" vertical layout>
              <div class="head" center horizontal layout>
                <div class="title">{{M.orderBook}}</div>
              </div>
              <div class="content" vertical layout>
                <table class="dense">
                  <thead>
                    <tr>
                      <td></td>
                      <td>{{M.price}}</td>
                      <td>{{M.quantity}}</td>
                      <td>{{M.accumulated}}</td>
                    </tr>
                  </thead>
                  <tbody>
                    <template repeat="{{bid,idx in bidsReverse}}">
                      <tr>
                        <td class="idx">{{bidsReverse.length - idx}}</td>
                        <td>
                          <nice-number class="buy" v="{{bid.price}}"></nice-number>
                        </td>
                        <td>
                          <nice-number v="{{bid.quantity}}"></nice-number>
                        </td>
                        <td>
                          <nice-number v="{{bid.accumulated}}"></nice-number>
                        </td>
                      </tr>
                    </template>

                    <tr>
                      <td id="spread" colspan="4">
                        <div id="container" center-justified horizontal center layout>
                          <div>{{M.spread}}:</div>
                          <div>
                            <nice-number v="{{spread}}"></nice-number>
                          </div>
                          <div> {{market.baseCurrency.unit}} </div>
                        </div>
                      </td>
                    </tr>
                    <template repeat="{{ask,idx in asks}}">
                      <tr>
                        <td class="idx">{{idx+1}}</td>
                        <td>
                          <nice-number class="sell" v="{{ask.price}}"></nice-number>
                        </td>
                        <td>
                          <nice-number v="{{ask.quantity}}"></nice-number>
                        </td>
                        <td>
                          <nice-number v="{{ask.accumulated}}"></nice-number>
                        </td>
                      </tr>
                    </template>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <div class="column" auto-vertical flex two vertical layout>
            <div class="block" vertical layout>
              <div class="head" center horizontal layout>
                <div class="title">{{M.priceChart}}</div>
              </div>
              <div class="content" vertical layout>
                this is the content
              </div>
            </div>

            <div class="block" id="depthchart" vertical layout>
              <div class="head" center horizontal layout>
                <div class="title">{{M.depthChart}}</div>
              </div>
              <div class="content" vertical layout>
                <depth-chart market="{{market}}" simple="{{true}}" height="180" bids="{{bids}}" asks="{{asks}}"></depth-chart>
              </div>
            </div>

            <div class="block" vertical layout>
              <div class="head" center horizontal layout>
                <div class="title">{{M.openOrders}}</div>
              </div>
              <div class="content" vertical layout>
                this is the content
              </div>
            </div>
          </div>

          <div class="column" auto-vertical flex vertical layout>
            <div class="block" vertical layout>
              <div class="head" center horizontal layout>
                <div class="title">{{M.tradeHistory}}</div>
              </div>
              <div class="content" vertical layout>
                <table class="dense">
                  <thead>
                    <tr>
                      <td></td>
                      <td>{{M.price}}</td>
                      <td>{{M.quantity}}</td>
                      <td>{{M.time}}</td>
                    </tr>
                  </thead>
                  <tbody>
                    <template repeat="{{record,idx in trades}}">
                      <tr>
                        <td class="idx">{{idx+1}}</td>
                        <td>
                          <nice-number class="{{record.class}}" v="{{record.price}}"></nice-number>
                        </td>
                        <td>
                          <nice-number v="{{record.quantity}}"></nice-number>
                        </td>
                        <td>
                          {{record.timestamp}}
                        </td>
                      </tr>
                    </template>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </core-header-panel>
    </core-drawer-panel>
  </template>

  <script src="market-pro-page.js"></script>
</polymer-element>
