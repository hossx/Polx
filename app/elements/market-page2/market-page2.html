<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../../bower_components/core-drawer-panel/core-drawer-panel.html">
<link rel="import" href="../../bower_components/core-header-panel/core-header-panel.html">
<link rel="import" href="../../bower_components/core-animated-pages/core-animated-pages.html">
<link rel="import" href="../../bower_components/core-animated-pages/transitions/slide-from-right.html">
<link rel="import" href="../../bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="../../bower_components/core-tooltip/core-tooltip.html">
<link rel="import" href="../../bower_components/core-icon/core-icon.html">
<link rel="import" href="../../bower_components/core-icon-button/core-icon-button.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/core-icons/communication-icons.html">
<link rel="import" href="../../bower_components/core-animated-pages/transitions/fade-all.html">
<link rel="import" href="../cp-icons/crypto-icons.html">
<link rel="import" href="../cp-footer/cp-footer.html">
<link rel="import" href="../nice-number/nice-number.html">
<link rel="import" href="../charts/depth-chart/depth-chart.html">
<link rel="import" href="../market-page/elements/market-sidebar.html">

<polymer-element name="market-page2" attributes="marketId">
  <template>
    <link rel="stylesheet" href="market-page2.css">
    <core-ajax url="{{orderBookUrl}}" handleAs="json" response="{{orderBookResp}}" auto></core-ajax>
    <core-ajax url="{{transactionsUrl}}" handleAs="json" response="{{tradeHistoryResp}}" auto></core-ajax>

    <core-drawer-panel forceNarrow>

      <core-header-panel mode="seamed" id="drawer" drawer>
        <market-sidebar marketId="{{marketId}}" altview="{{true}}"></market-sidebar>
      </core-header-panel>

      <core-header-panel id="main-panel" mode="waterfall" fix main>
        <core-toolbar class="core-header" id="toolbar">
          <a href="/#/markets" id="backlink">
            <paper-icon-button icon="arrow-back"></paper-icon-button>
          </a>
          <paper-icon-button icon="menu" core-drawer-toggle></paper-icon-button>
          <div flex id="label">{{market.name}}</div>
          <a href="/#/market/{{marketId}}">
            <core-tooltip label="{{M.relaxMode}}" position="left">
              <paper-icon-button icon="explore"></paper-icon-button>
            </core-tooltip>
          </a>
        </core-toolbar>

        <div id="main" flex horizontal layout main>
          <div class="column" vertical layout>
            <div class="block" id="availableBalance" vertical layout>
              <div class="head" horizontal layout>
                <div class="title">{{M.availableBalance}}</div>
              </div>
              <div class="content" vertical layout>
                <div class="actions" horizontal layout>
                  <paper-button flex>
                    <core-icon class="small" icon="communication:call-received"></core-icon> Deposit</paper-button>
                  <paper-button flex>
                    <core-icon class="small" icon="communication:call-made"></core-icon> Withdrawal</paper-button>
                </div>
                <div class="balance" horizontal layout>
                  <div flex><a href="/#/currency/{{market.baseCurrency.id}}">{{market.baseCurrency.id}}</a>
                  </div>
                  <div flex>
                    <nice-number v="{{123}}"></nice-number>
                  </div>
                </div>
                <div class="balance" horizontal layout>
                  <div flex><a href="/#/currency/{{market.currency.id}}">{{market.currency.id}}</a>
                  </div>
                  <div flex>
                    <nice-number v="{{123}}"></nice-number>
                  </div>
                </div>
              </div>
            </div>

            <div class="block" id="trade" vertical layout>
              <div class="content" vertical layout>
                <paper-tabs selected="{{selected}}">
                  <paper-tab>AAA</paper-tab>
                  <paper-tab>BBB</paper-tab>
                </paper-tabs>
                <core-animated-pages flex class="pages" selected="{{selected}}" transitions="fade-all">
                  <section>
                    <div class="form" vertical layout>
                      x
                    </div>
                  </section>
                  <section>
                    <div class="form" vertical layout>
                      afdafa
                    </div>
                  </section>
                </core-animated-pages>
              </div>
            </div>
          </div>

          <div class="column" vertical layout>
            <div class="block" id="orderbook" vertical layout>
              <div class="head" horizontal layout>
                <div class="title">{{M.orderBook}}</div>
              </div>
              <div class="content" vertical layout>
                <table>
                  <thead>
                    <tr>
                      <td></td>
                      <td>{{M.price}}</td>
                      <td>{{M.quantity}}</td>
                      <td>{{M.accumulated}}</td>
                    </tr>
                  </thead>
                  <tbody>
                    <template repeat="{{bid,idx in bidsReverse}}">
                      <tr>
                        <td class="idx">{{bidsReverse.length - idx}}</td>
                        <td>
                          <nice-number class="buy" v="{{bid.price}}"></nice-number>
                        </td>
                        <td>
                          <nice-number v="{{bid.quantity}}"></nice-number>
                        </td>
                        <td>
                          <nice-number v="{{bid.accumulated}}"></nice-number>
                        </td>
                      </tr>
                    </template>

                    <tr>
                      <td id="lastPrice" colspan="4">
                        ????? {{market.baseCurrency.unit}}
                      </td>
                    </tr>
                    <template repeat="{{ask,idx in asks}}">
                      <tr>
                        <td class="idx">{{idx+1}}</td>
                        <td>
                          <nice-number class="sell" v="{{ask.price}}"></nice-number>
                        </td>
                        <td>
                          <nice-number v="{{ask.quantity}}"></nice-number>
                        </td>
                        <td>
                          <nice-number v="{{ask.accumulated}}"></nice-number>
                        </td>
                      </tr>
                    </template>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <div class="column wide" vertical layout>
            <div class="block" vertical layout>
              <div class="head" horizontal layout>
                <div class="title">{{M.priceChart}}</div>
              </div>
              <div class="content" vertical layout>
                this is the content
              </div>
            </div>

            <div class="block" id="depthchart" vertical layout>
              <div class="head" horizontal layout>
                <div class="title">{{M.depthChart}}</div>
              </div>
              <div class="content" vertical layout>
                <depth-chart market="{{market}}" simple="{{true}}" height="180" bids="{{bids}}" asks="{{asks}}"></depth-chart>
              </div>
            </div>

            <div class="block" vertical layout>
              <div class="head" horizontal layout>
                <div class="title">{{M.openOrders}}</div>
              </div>
              <div class="content" vertical layout>
                this is the content
              </div>
            </div>
          </div>

          <div class="column" vertical layout>
            <div class="block" vertical layout>
              <div class="head" horizontal layout>
                <div class="title">{{M.tradeHistory}}</div>
              </div>
              <div class="content" vertical layout>
                <table>
                  <thead>
                    <tr>
                      <td></td>
                      <td>{{M.price}}</td>
                      <td>{{M.quantity}}</td>
                      <td>{{M.time}}</td>
                    </tr>
                  </thead>
                  <tbody>
                    <template repeat="{{record,idx in tradeHistory}}">
                      <tr>
                        <td class="idx">{{idx+1}}</td>
                        <td>
                          <nice-number class="{{record.class}}" v="{{record.price}}"></nice-number>
                        </td>
                        <td>
                          <nice-number v="{{record.quantity}}"></nice-number>
                        </td>
                        <td>
                          {{record.timestamp}}
                        </td>
                      </tr>
                    </template>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </core-header-panel>
    </core-drawer-panel>
  </template>

  <script src="market-page2.js"></script>
</polymer-element>
